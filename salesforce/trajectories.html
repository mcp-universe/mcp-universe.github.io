<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Universe - Trajectory Comparison</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .back-btn {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .controls-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .controls-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .controls-header h2 {
            color: #2c3e50;
            font-size: 1.8em;
        }

        .agent-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .agent-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: #f8f9fa;
            border: 2px solid #dee2e6;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .agent-checkbox:hover {
            background: #e9ecef;
        }

        .agent-checkbox.selected {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-color: #2980b9;
        }

        .agent-checkbox input[type="checkbox"] {
            display: none;
        }

        .trajectory-selector {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .trajectory-selector label {
            font-weight: 600;
            color: #2c3e50;
        }

        .trajectory-selector select {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 5px;
            background: white;
            font-size: 1em;
        }

        .comparison-container {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .comparison-container.single {
            grid-template-columns: 1fr;
        }

        .comparison-container.double {
            grid-template-columns: 1fr 1fr;
        }

        .comparison-container.triple {
            grid-template-columns: 1fr 1fr 1fr;
        }

        .agent-column {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .agent-header {
            padding: 20px;
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            text-align: center;
        }

        .agent-header h3 {
            font-size: 1.4em;
            margin-bottom: 5px;
        }

        .agent-meta {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .trajectory-content {
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .trajectory-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .trajectory-card:hover {
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.1);
        }

        .trajectory-header {
            background: linear-gradient(135deg, #495057, #343a40);
            color: white;
            padding: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .trajectory-header:hover {
            background: linear-gradient(135deg, #343a40, #495057);
        }

        .trajectory-title {
            font-size: 1em;
            font-weight: 600;
        }

        .trajectory-meta-info {
            display: flex;
            gap: 10px;
            font-size: 0.85em;
            opacity: 0.9;
        }

        .expand-icon {
            font-size: 1.1em;
            transition: transform 0.3s ease;
        }

        .trajectory-card.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .trajectory-details {
            display: none;
            padding: 20px;
        }

        .trajectory-card.expanded .trajectory-details {
            display: block;
        }

        .question-section {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #2196f3;
        }

        .question-section h4 {
            color: #1976d2;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .steps-container {
            margin-top: 15px;
        }

        .step-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-bottom: 10px;
            overflow: hidden;
        }

        .step-header {
            background: #f8f9fa;
            padding: 12px;
            border-bottom: 1px solid #dee2e6;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .step-header:hover {
            background: #e9ecef;
        }

        .step-title {
            font-weight: 600;
            color: #495057;
            font-size: 0.95em;
        }

        .step-content {
            display: none;
            padding: 15px;
        }

        .step-card.expanded .step-content {
            display: block;
        }

        .step-card.expanded .step-header .expand-icon {
            transform: rotate(180deg);
        }

        .tool-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 8px;
            margin: 8px 0;
            font-size: 0.9em;
        }

        .tool-name {
            font-weight: bold;
            color: #856404;
        }

        .tool-result {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 10px;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.8em;
            max-height: 150px;
            overflow-y: auto;
        }

        .answer-section {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #28a745;
        }

        .answer-section h4 {
            color: #155724;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .answer-content {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 10px;
            border-radius: 5px;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.85em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .no-selection {
            text-align: center;
            padding: 60px 20px;
            color: #666;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .no-selection h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        .stats-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: rgba(52, 152, 219, 0.1);
            border-radius: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #2980b9;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            color: #666;
        }

        @media (max-width: 1200px) {
            .comparison-container.triple {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .comparison-container.double,
            .comparison-container.triple {
                grid-template-columns: 1fr;
            }
            
            .agent-selector {
                flex-direction: column;
            }
            
            .controls-header {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-btn">← Back to Overview</a>
            <h1>📊 Trajectory Comparison</h1>
            <p class="subtitle">Compare AI Agent Performance Across Different Architectures</p>
        </header>

        <div class="controls-section">
            <div class="controls-header">
                <h2>🎛️ Comparison Controls</h2>
                <div class="trajectory-selector">
                    <label for="trajectory-select">Trajectory:</label>
                    <select id="trajectory-select">
                        <option value="1">Trajectory #1 - Service Dependencies</option>
                        <option value="2">Trajectory #2 - Service Dependencies (Alt)</option>
                        <option value="3">Trajectory #3 - Mission Critical Services</option>
                        <option value="4">Trajectory #4 - Splunk Analysis</option>
                        <option value="5">Trajectory #5 - GUS Product Tags</option>
                        <option value="6">Trajectory #6 - GUS Investigations</option>
                        <option value="7">Trajectory #7 - Splunk Queries</option>
                        <option value="8">Trajectory #8 - PagerDuty Incidents</option>
                    </select>
                </div>
            </div>
            
            <div class="agent-selector">
                <label class="agent-checkbox" id="react-transform-checkbox">
                    <input type="checkbox" value="react-transform">
                    <span>🔄 ReAct + Tool Summarization</span>
                </label>
                <label class="agent-checkbox" id="react-no-transform-checkbox">
                    <input type="checkbox" value="react-no-transform">
                    <span>🔄 ReAct (Standard)</span>
                </label>
                <label class="agent-checkbox" id="cursor-agent-checkbox">
                    <input type="checkbox" value="cursor-agent">
                    <span>💻 Cursor Agent</span>
                </label>
            </div>
        </div>

        <div id="comparison-area">
            <div class="no-selection">
                <h3>🎯 Select Agent Types to Compare</h3>
                <p>Choose one or more agent types above to view and compare their trajectories for the selected task.</p>
                <p style="margin-top: 15px; color: #888;">
                    You can compare up to 3 different agent approaches side by side to analyze their reasoning patterns, 
                    tool usage, and performance differences.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Sample data structure - in a real implementation, this would be loaded from separate files
        const trajectoryData = {
            'react-transform': null, // Will be loaded from trajectories_data.json
            'react-no-transform': null, // Would be loaded from a separate file
            'cursor-agent': null // Would be loaded from a separate file
        };

        let selectedAgents = new Set();
        let selectedTrajectoryId = '1';

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadTrajectoryData();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Agent selection checkboxes
            document.querySelectorAll('.agent-checkbox input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const agentType = this.value;
                    const label = this.closest('.agent-checkbox');
                    
                    if (this.checked) {
                        selectedAgents.add(agentType);
                        label.classList.add('selected');
                    } else {
                        selectedAgents.delete(agentType);
                        label.classList.remove('selected');
                    }
                    
                    updateComparison();
                });
            });

            // Trajectory selection
            document.getElementById('trajectory-select').addEventListener('change', function() {
                selectedTrajectoryId = this.value;
                updateComparison();
            });
        }

        async function loadTrajectoryData() {
            try {
                // Load ReAct + Transform data (existing file)
                const response = await fetch('trajectories_data.json');
                trajectoryData['react-transform'] = await response.json();
                
                // For demo purposes, create mock data for the other agent types
                // In a real implementation, these would be loaded from separate files
                trajectoryData['react-no-transform'] = createMockData('ReAct (Standard)', 'react-no-transform');
                trajectoryData['cursor-agent'] = createMockData('Cursor Agent', 'cursor-agent');
                
            } catch (error) {
                console.error('Error loading trajectory data:', error);
            }
        }

        function createMockData(agentName, agentType) {
            // Create mock data structure similar to the real data
            // This is for demonstration - in reality, you'd have separate trajectory files
            const baseData = {
                "metadata": {
                    "source_file": `${agentType}_benchmark.log`,
                    "total_trajectories": 8,
                    "extraction_timestamp": new Date().toISOString()
                },
                "trajectories": []
            };

            // Create mock trajectories with different characteristics
            for (let i = 1; i <= 8; i++) {
                const trajectory = {
                    "trajectory_id": i,
                    "trace_id": generateMockTraceId(),
                    "question": getQuestionForTrajectory(i),
                    "steps": generateMockSteps(agentType, i),
                    "answer": generateMockAnswer(i)
                };
                baseData.trajectories.push(trajectory);
            }

            return baseData;
        }

        function generateMockTraceId() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        function getQuestionForTrajectory(id) {
            const questions = [
                "Get the list of all services that has keyword 'sdb'. From the details of these services and their dependencies, find the longest chains of 'start' dependencies, 'validate' dependencies and 'authorized' clients dependencies.",
                "Get the list of all services that has keyword 'sdb'. From the details of these services and their dependencies, find the longest chains of 'start' dependencies, 'validate' dependencies and 'authorized' clients dependencies.",
                "For mission critical services related to 'sdb' check if they have a disaster recovery runbook (usually this would be inside their deployment runbook information) and if their utility pipelines are fit (Falcon Integration Test) (You can assume pipelines that are FIT will have that appropriately titled). Generate a comprehensive report in the given format",
                "Get the stats of the top 5 trace ids (from mdc.trace_id field of the splunk logs) from the splunk logs for services with names starting with 'bot-svc-llm' prefix, with index=globaldefault and check for any '504 Gateway Timeout' error pattern in those services from 10:00 to 10:05 yesterday (UTC time).\n- Then get the list of Top SQL, SOQL and LLM queries in terms of longest duration and the avg duration of the SQL, SOQL and LLM queries related to these splunk logs by analyzing their trace ids.",
                "Get the GUS product tags for all the mission critical services (whose names start with 'bot-svc-llm' prefix).",
                "For all the mission critical services (which names starting with 'bot-svc-llm' prefix), get their gus product tags  (from the gusProductTagId field in their service definition) and from that the list of gus investigations created for those services in the last 10 days. Finally output the list of gus investigation ids (ids usually in format 'W-<numbers>')",
                "For all the mission critical services which name 'bot-svc-llm', get their gus product tags (from the gusProductTagId field in their service definition) and from that the list of gus investigations created for those services in the last 10 days. From the GUS investigations extract the gus investigation ids (in format 'W-<numbers>') and the exact splunk queries that were used during the investigations. Generate your output as a list of splunk queries.",
                "First list the teams related to Core Database Performance. Then find the start time (in epoch_seconds) format of the Connection Pool (or often abbreviated in different forms) related incidents handled by those teams in the last 60 days."
            ];
            return questions[id - 1] || questions[0];
        }

        function generateMockSteps(agentType, trajectoryId) {
            const stepCount = Math.floor(Math.random() * 15) + 8; // 8-22 steps
            const steps = [];
            
            for (let i = 1; i <= stepCount; i++) {
                const step = {
                    "step_number": i,
                    "llm_response": generateMockLLMResponse(agentType, i),
                    "tool_name": generateMockToolName(i),
                    "tool_result": generateMockToolResult(agentType, i),
                    "tool_call": generateMockToolCall(i)
                };
                steps.push(step);
            }
            
            return steps;
        }

        function generateMockLLMResponse(agentType, stepNumber) {
            const responses = {
                'react-no-transform': [
                    "I need to start by listing all services that contain the keyword 'sdb' to understand the scope of services I'm working with.",
                    "Now I have the list of services. I need to get detailed information about each service to analyze their dependencies.",
                    "I'll continue gathering service definitions to build a complete picture of the dependency chains.",
                    "Based on the service definitions I've collected, I need to analyze the dependency relationships."
                ],
                'cursor-agent': [
                    "Let me analyze the codebase to understand the service architecture and identify services with 'sdb' keyword.",
                    "I'll examine the service configuration files to extract dependency information systematically.",
                    "Now I need to trace through the dependency chains to find the longest paths.",
                    "I'll compile the results into a structured format for easy analysis."
                ]
            };
            
            const agentResponses = responses[agentType] || responses['react-no-transform'];
            return agentResponses[stepNumber % agentResponses.length] || "Continuing with the analysis...";
        }

        function generateMockToolName(stepNumber) {
            const tools = ['list_services', 'get_service_definition', 'query_splunk', 'get_gus_investigations_by_product_tags', 'pagerduty_get_teams'];
            return tools[stepNumber % tools.length];
        }

        function generateMockToolResult(agentType, stepNumber) {
            return `Mock result for ${agentType} step ${stepNumber} - this would contain actual API response data`;
        }

        function generateMockToolCall(stepNumber) {
            return `Mock tool call ${stepNumber} - this would show the actual function call made`;
        }

        function generateMockAnswer(trajectoryId) {
            if (trajectoryId % 3 === 0) {
                return "I'm sorry, but I couldn't find a satisfactory answer within the allowed number of iterations.";
            }
            
            return {
                "status": "success",
                "services_analyzed": Math.floor(Math.random() * 20) + 10,
                "longest_chain_length": Math.floor(Math.random() * 8) + 3,
                "completion_time": `${Math.floor(Math.random() * 300) + 60} seconds`
            };
        }

        function updateComparison() {
            const comparisonArea = document.getElementById('comparison-area');
            
            if (selectedAgents.size === 0) {
                comparisonArea.innerHTML = `
                    <div class="no-selection">
                        <h3>🎯 Select Agent Types to Compare</h3>
                        <p>Choose one or more agent types above to view and compare their trajectories for the selected task.</p>
                        <p style="margin-top: 15px; color: #888;">
                            You can compare up to 3 different agent approaches side by side to analyze their reasoning patterns, 
                            tool usage, and performance differences.
                        </p>
                    </div>
                `;
                return;
            }

            const containerClass = selectedAgents.size === 1 ? 'single' : 
                                 selectedAgents.size === 2 ? 'double' : 'triple';
            
            let html = `<div class="comparison-container ${containerClass}">`;
            
            selectedAgents.forEach(agentType => {
                html += createAgentColumn(agentType, selectedTrajectoryId);
            });
            
            html += '</div>';
            comparisonArea.innerHTML = html;
            
            // Add event listeners for expand/collapse functionality
            addTrajectoryEventListeners();
        }

        function createAgentColumn(agentType, trajectoryId) {
            const data = trajectoryData[agentType];
            if (!data) {
                return `
                    <div class="agent-column">
                        <div class="agent-header">
                            <h3>${getAgentDisplayName(agentType)}</h3>
                            <div class="agent-meta">Loading...</div>
                        </div>
                        <div class="trajectory-content">
                            <div class="loading">Loading trajectory data...</div>
                        </div>
                    </div>
                `;
            }

            const trajectory = data.trajectories.find(t => t.trajectory_id == trajectoryId);
            if (!trajectory) {
                return `
                    <div class="agent-column">
                        <div class="agent-header">
                            <h3>${getAgentDisplayName(agentType)}</h3>
                            <div class="agent-meta">Trajectory not found</div>
                        </div>
                        <div class="trajectory-content">
                            <div class="error">Trajectory #${trajectoryId} not found for this agent type.</div>
                        </div>
                    </div>
                `;
            }

            const isSuccessful = trajectory.answer && typeof trajectory.answer === 'object' && Object.keys(trajectory.answer).length > 0;
            const statusIcon = isSuccessful ? '✅' : '❌';
            const statusText = isSuccessful ? 'Successful' : 'Failed';

            return `
                <div class="agent-column">
                    <div class="agent-header">
                        <h3>${getAgentDisplayName(agentType)}</h3>
                        <div class="agent-meta">
                            ${statusIcon} ${statusText} • ${trajectory.steps.length} steps
                        </div>
                    </div>
                    <div class="trajectory-content">
                        ${createTrajectoryStats(trajectory)}
                        ${createTrajectoryCard(trajectory, agentType)}
                    </div>
                </div>
            `;
        }

        function createTrajectoryStats(trajectory) {
            const isSuccessful = trajectory.answer && typeof trajectory.answer === 'object' && Object.keys(trajectory.answer).length > 0;
            const toolCalls = trajectory.steps.filter(s => s.tool_name).length;
            const avgStepLength = Math.round(trajectory.steps.reduce((sum, s) => sum + (s.llm_response?.length || 0), 0) / trajectory.steps.length);

            return `
                <div class="stats-summary">
                    <div class="stat-item">
                        <span class="stat-value">${trajectory.steps.length}</span>
                        <span class="stat-label">Total Steps</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${toolCalls}</span>
                        <span class="stat-label">Tool Calls</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${avgStepLength}</span>
                        <span class="stat-label">Avg Response Length</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${isSuccessful ? 'Yes' : 'No'}</span>
                        <span class="stat-label">Success</span>
                    </div>
                </div>
            `;
        }

        function createTrajectoryCard(trajectory, agentType) {
            return `
                <div class="trajectory-card" data-id="${trajectory.trajectory_id}-${agentType}">
                    <div class="trajectory-header" onclick="toggleTrajectory('${trajectory.trajectory_id}-${agentType}')">
                        <div>
                            <div class="trajectory-title">Trajectory #${trajectory.trajectory_id}</div>
                            <div class="trajectory-meta-info">
                                <span>🔗 ${trajectory.trace_id.substring(0, 8)}...</span>
                            </div>
                        </div>
                        <div class="expand-icon">▼</div>
                    </div>
                    <div class="trajectory-details">
                        <div class="question-section">
                            <h4>🎯 Question</h4>
                            <p>${trajectory.question}</p>
                        </div>
                        
                        <div class="steps-container">
                            <h4>🔄 Execution Steps</h4>
                            ${trajectory.steps.map(step => createStepCard(step, agentType)).join('')}
                        </div>
                        
                        ${trajectory.answer ? createAnswerSection(trajectory.answer) : ''}
                    </div>
                </div>
            `;
        }

        function createStepCard(step, agentType) {
            return `
                <div class="step-card" data-step="${step.step_number}-${agentType}">
                    <div class="step-header" onclick="toggleStep('${step.step_number}-${agentType}', event)">
                        <div class="step-title">
                            Step ${step.step_number}: ${step.tool_name || 'Analysis'}
                        </div>
                        <div class="expand-icon">▼</div>
                    </div>
                    <div class="step-content">
                        <div>
                            <strong>🤖 LLM Response:</strong>
                            <p>${step.llm_response}</p>
                        </div>
                        
                        ${step.tool_name ? `
                            <div class="tool-info">
                                <div class="tool-name">🔧 Tool: ${step.tool_name}</div>
                            </div>
                        ` : ''}
                        
                        ${step.tool_result ? `
                            <div>
                                <strong>📊 Tool Result:</strong>
                                <div class="tool-result">${truncateText(step.tool_result, 300)}</div>
                            </div>
                        ` : ''}
                        
                        ${step.tool_call ? `
                            <div>
                                <strong>📞 Tool Call:</strong>
                                <div class="tool-result">${truncateText(step.tool_call, 200)}</div>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function createAnswerSection(answer) {
            const answerText = typeof answer === 'string' ? answer : JSON.stringify(answer, null, 2);
            
            return `
                <div class="answer-section">
                    <h4>✨ Final Answer</h4>
                    <div class="answer-content">${answerText}</div>
                </div>
            `;
        }

        function getAgentDisplayName(agentType) {
            const names = {
                'react-transform': '🔄 ReAct + Tool Summarization',
                'react-no-transform': '🔄 ReAct (Standard)',
                'cursor-agent': '💻 Cursor Agent'
            };
            return names[agentType] || agentType;
        }

        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '... <em>(truncated)</em>';
        }

        function addTrajectoryEventListeners() {
            // Re-add event listeners after DOM update
            // This function is called after updateComparison() creates new DOM elements
        }

        function toggleTrajectory(trajectoryId) {
            const card = document.querySelector(`[data-id="${trajectoryId}"]`);
            if (card) {
                card.classList.toggle('expanded');
            }
        }

        function toggleStep(stepId, event) {
            event.stopPropagation();
            const stepCard = document.querySelector(`[data-step="${stepId}"]`);
            if (stepCard) {
                stepCard.classList.toggle('expanded');
            }
        }
    </script>
</body>
</html>
